<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>GIF Carousel</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #101828, #1d2939);
        color: #f5f5f5;
      }

      .carousel {
        box-sizing: border-box;
        width: 320px;
        height: 240px;
        background: rgba(15, 23, 42, 0.7);
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(15, 23, 42, 0.4);
        position: relative;
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      #timestampRaf {
        position: absolute;
        top: 16px;
        left: 16px;
        font-weight: 600;
        font-size: 0.875rem;
        letter-spacing: 0.08em;
        color: #f5f5f5;
        background: rgba(15, 23, 42, 0.65);
        padding: 4px 12px;
        border-radius: 999px;
      }

      .carousel__title {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        letter-spacing: 0.04em;
      }

      .carousel__viewport {
        flex: 1;
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.08);
        display: grid;
        place-items: center;
      }

      .carousel__image {
        width: 100%;
        height: 100%;
        object-fit: contain;
        position: absolute;
        inset: 0;
        opacity: 0;
        transition: opacity 300ms ease-in-out;
      }

      .carousel__image--active {
        opacity: 1;
      }

      .carousel__indicator {
        display: flex;
        justify-content: center;
        gap: 8px;
      }

      .carousel__dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(148, 163, 184, 0.6);
        transition: transform 200ms ease, background 200ms ease;
      }

      .carousel__dot--active {
        transform: scale(1.6);
        background: #fbbf24;
      }
    </style>
  </head>
  <body>
    <div class="carousel" role="region" aria-label="Animated GIF carousel">
      <div id="timestampRaf">00:00.000</div>
      <h1 class="carousel__title">GIF Highlights</h1>
      <div class="carousel__viewport">
        <img
          data-gif-index="0"
          alt="Orbiting light trail"
          class="carousel__image carousel__image--active"
        />
        <img
          data-gif-index="1"
          alt="Colorful orbiting dot"
          class="carousel__image"
        />
      </div>
      <div class="carousel__indicator" aria-hidden="true">
        <span class="carousel__dot carousel__dot--active"></span>
        <span class="carousel__dot"></span>
      </div>
    </div>

    <script type="module">
      const gifSlides = ["./img/slide1.gif", "./img/slide2.gif"];

      const STOP_AT_MS = 4000;
      const INTERVAL_MS = 2000;

      const images = Array.from(document.querySelectorAll(".carousel__image"));
      const dots = Array.from(document.querySelectorAll(".carousel__dot"));
      const timestampElement = document.getElementById("timestampRaf");

      const totalSlides = gifSlides.length;

      const INITIAL_ACTIVE_INDEX = Math.max(
        0,
        images.findIndex((image) =>
          image.classList.contains("carousel__image--active")
        )
      );
      const FINAL_SLIDE_INDEX =
        totalSlides > 0
          ? (INITIAL_ACTIVE_INDEX +
              Math.max(0, Math.floor((STOP_AT_MS - 1) / INTERVAL_MS))) %
            totalSlides
          : 0;

      images.forEach((image, fallbackIndex) => {
        const gifIndex = Number.parseInt(image.dataset.gifIndex ?? "", 10);
        const resolvedIndex = Number.isFinite(gifIndex) ? gifIndex : fallbackIndex;
        const normalizedIndex = ((resolvedIndex % totalSlides) + totalSlides) % totalSlides;
        image.src = gifSlides[normalizedIndex];
      });

      let activeIndex = 0;
      let carouselTimerId = null;
      let completedIntervals = 0;

      function formatElapsedTime(milliseconds) {
        const elapsed = Math.max(0, Math.floor(milliseconds));
        const totalSeconds = Math.floor(elapsed / 1000);
        const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
        const seconds = String(totalSeconds % 60).padStart(2, "0");
        const ms = String(elapsed % 1000).padStart(3, "0");
        return `${minutes}:${seconds}.${ms}`;
      }

      function showSlide(nextIndex) {
        images[activeIndex].classList.remove("carousel__image--active");
        dots[activeIndex].classList.remove("carousel__dot--active");

        activeIndex = nextIndex;

        images[activeIndex].classList.add("carousel__image--active");
        dots[activeIndex].classList.add("carousel__dot--active");
      }

      function startCarousel() {
        carouselTimerId = setInterval(() => {
          const projectedIntervals = completedIntervals + 1;

          if (projectedIntervals * INTERVAL_MS >= STOP_AT_MS && carouselTimerId !== null) {
            clearInterval(carouselTimerId);
            carouselTimerId = null;
            completedIntervals = Math.max(
              completedIntervals,
              Math.floor((STOP_AT_MS - 1) / INTERVAL_MS)
            );

            if (activeIndex !== FINAL_SLIDE_INDEX) {
              showSlide(FINAL_SLIDE_INDEX);
            }

            return;
          }

          const nextIndex = (activeIndex + 1) % images.length;
          showSlide(nextIndex);
          completedIntervals = projectedIntervals;
        }, INTERVAL_MS);
      }

      const startTime = performance.now();

      function updateTimestamp() {
        const elapsed = performance.now() - startTime;
        timestampElement.textContent = formatElapsedTime(
          Math.min(elapsed, STOP_AT_MS)
        );

        if (elapsed < STOP_AT_MS) {
          requestAnimationFrame(updateTimestamp);
        }
      }

      startCarousel();
      requestAnimationFrame(updateTimestamp);
    </script>
  </body>
</html>
